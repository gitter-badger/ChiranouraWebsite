<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml'>
<head>
<meta charset='utf-8'>
<meta content='nanoc 3.1.7' name='generator'>
<title>
ちらのうら - RedcarpetのレンダラにCodeRayによるシンタックスハイライトを追加
</title>
<link href='/stylesheets/screen.css' media='screen' rel='stylesheet' type='text/css'>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  
  ga('create', 'UA-44690113-1', 'nobody.jp');
  ga('send', 'pageview');
</script>
</head>
<body>
<div id='container'>
<div id='header'>
<h1>ちらのうら</h1>
</div>
<div id='main'>
<div class='article'>
<h2 class='Science'><a href="/articles/2014-01-23_01_using_coderay_with_redcarpet/">RedcarpetのレンダラにCodeRayによるシンタックスハイライトを追加</a></h2>
<h3 class='Science'>Created in: 2014-01-23  Author: iray_tno Category: <a href="/category/science" rel="tag">Science</a> Tags: <a href="/category/science/tag/computer" rel="tag">Computer</a><a href="/tag/computer" rel="tag">_a</a>, <a href="/category/science/tag/ruby" rel="tag">Ruby</a><a href="/tag/ruby" rel="tag">_a</a>, <a href="/category/science/tag/nanoc" rel="tag">nanoc</a><a href="/tag/nanoc" rel="tag">_a</a>, <a href="/category/science/tag/redcarpet" rel="tag">Redcarpet</a><a href="/tag/redcarpet" rel="tag">_a</a>, <a href="/category/science/tag/coderay" rel="tag">CodeRay</a><a href="/tag/coderay" rel="tag">_a</a></h3>
<p>このブログは記事をMarkdownで書いてnanocでRedcarpetを通して静的なHTMLを生成しています。</p>

<p>Redcarpetでは、レンダラを継承して独自に定義することで拡張が可能です。</p>

<p>そこで、CodeRayを追加してMarkdown内のコードブロックにシンタックスハイライトを適用してみます。</p>

<!-- headline -->

<p>CodeRayはgemでインストールします。</p>
<table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
</pre></td>
  <td class="code"><pre>$ gem install coderay
</pre></td>
</tr></table>

<p>nanocにRedcarpetのレンダラを追加するには、lib/default.rbにレンダラを定義して、Rulesファイル内のフィルタに以下のようにオプションを追加します。</p>
<table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
<a href="#n4" name="n4">4</a>
<a href="#n5" name="n5">5</a>
<a href="#n6" name="n6">6</a>
<a href="#n7" name="n7">7</a>
<a href="#n8" name="n8">8</a>
<a href="#n9" name="n9">9</a>
<strong><a href="#n10" name="n10">10</a></strong>
<a href="#n11" name="n11">11</a>
<a href="#n12" name="n12">12</a>
<a href="#n13" name="n13">13</a>
<a href="#n14" name="n14">14</a>
<a href="#n15" name="n15">15</a>
<a href="#n16" name="n16">16</a>
<a href="#n17" name="n17">17</a>
<a href="#n18" name="n18">18</a>
<a href="#n19" name="n19">19</a>
<strong><a href="#n20" name="n20">20</a></strong>
<a href="#n21" name="n21">21</a>
<a href="#n22" name="n22">22</a>
<a href="#n23" name="n23">23</a>
<a href="#n24" name="n24">24</a>
<a href="#n25" name="n25">25</a>
<a href="#n26" name="n26">26</a>
</pre></td>
  <td class="code"><pre><span style="color:#777">#Rules</span>
<span style="color:#777">#compile -----------------------------------------------------------------------</span>
compile <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">/stylesheet/</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="color:#777"># don’t filter or layout</span>
<span style="color:#080;font-weight:bold">end</span>

compile <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">*</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="color:#080;font-weight:bold">if</span> item.binary?
    <span style="color:#777"># don't filter binary items</span>
  <span style="color:#080;font-weight:bold">else</span>
    <span style="color:#080;font-weight:bold">case</span> item[<span style="color:#A60">:extension</span>]
      <span style="color:#080;font-weight:bold">when</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">md</span><span style="color:#710">'</span></span>
        filter <span style="color:#A60">:redcarpet</span>, <span style="color:#A60">:options</span> =&gt; {<span style="color:#A60">:fenced_code_blocks</span> =&gt; <span style="color:#069">true</span>, <span style="color:#A60">:autolink</span> -&gt; <span style="color:#069">true</span>},
                           <span style="color:#A60">:renderer</span> =&gt; <span style="color:#036;font-weight:bold">ArticleRenderer</span>
        layout <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">default</span><span style="color:#710">'</span></span>
      <span style="color:#080;font-weight:bold">when</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">haml</span><span style="color:#710">'</span></span>
        filter <span style="color:#A60">:haml</span>
        layout <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">default</span><span style="color:#710">'</span></span>
      <span style="color:#080;font-weight:bold">when</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">sass</span><span style="color:#710">'</span></span>
        filter <span style="color:#A60">:sass</span>, sass_options.merge(<span style="color:#A60">:syntax</span> =&gt; item[<span style="color:#A60">:extension</span>].to_sym)
      <span style="color:#080;font-weight:bold">else</span>
        filter <span style="color:#A60">:haml</span>
        layout <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">default</span><span style="color:#710">'</span></span>
    <span style="color:#080;font-weight:bold">end</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></td>
</tr></table>

<p>レンダラの定義は以下のようになりました。:line_numbers =&gt; :tableとすると、行数がテーブルで表示されるようになります。</p>
<table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
<a href="#n4" name="n4">4</a>
<a href="#n5" name="n5">5</a>
<a href="#n6" name="n6">6</a>
<a href="#n7" name="n7">7</a>
<a href="#n8" name="n8">8</a>
<a href="#n9" name="n9">9</a>
<strong><a href="#n10" name="n10">10</a></strong>
<a href="#n11" name="n11">11</a>
<a href="#n12" name="n12">12</a>
<a href="#n13" name="n13">13</a>
</pre></td>
  <td class="code"><pre><span style="color:#777">#lib/default.rb</span>
require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">redcarpet</span><span style="color:#710">&quot;</span></span>
require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">coderay</span><span style="color:#710">&quot;</span></span>

<span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">ArticlesRenderer</span> &lt; <span style="color:#036;font-weight:bold">Redcarpet</span>::<span style="color:#036;font-weight:bold">Render</span>::<span style="color:#036;font-weight:bold">XHTML</span>
  <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">block_code</span>(code, language)
    <span style="color:#080;font-weight:bold">if</span> language <span style="color:#080;font-weight:bold">then</span>
      <span style="color:#036;font-weight:bold">CodeRay</span>.scan(code, language).div(<span style="color:#A60">:line_numbers</span> =&gt; <span style="color:#A60">:table</span>)
    <span style="color:#080;font-weight:bold">else</span>
      <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#b0b">\n</span><span style="color:#D20">&lt;pre&gt;&lt;code&gt;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>code<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">&lt;/code&gt;&lt;/pre&gt;</span><span style="color:#b0b">\n</span><span style="color:#710">&quot;</span></span>
    <span style="color:#080;font-weight:bold">end</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></td>
</tr></table>

<p>以下は出力の例です。後はCSSで整形してきれいに表示されるようにしましょう。</p>
<table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
<a href="#n4" name="n4">4</a>
</pre></td>
  <td class="code"><pre>#markdown
　```ruby
　puts 'hello, world'
　```
</pre></td>
</tr></table>
<table class="CodeRay"><tr>
  <td class="line-numbers"><pre><a href="#n1" name="n1">1</a>
<a href="#n2" name="n2">2</a>
<a href="#n3" name="n3">3</a>
<a href="#n4" name="n4">4</a>
<a href="#n5" name="n5">5</a>
<a href="#n6" name="n6">6</a>
</pre></td>
  <td class="code"><pre><span style="color:#070;font-weight:bold">&lt;table</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">CodeRay</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span><span style="color:#070;font-weight:bold">&lt;tr&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;td</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">line-numbers</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span><span style="color:#070;font-weight:bold">&lt;pre&gt;</span><span style="color:#070;font-weight:bold">&lt;a</span> <span style="color:#b48">href</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">#n1</span><span style="color:#710">&quot;</span></span> <span style="color:#b48">name</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">n1</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>1<span style="color:#070;font-weight:bold">&lt;/a&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/pre&gt;</span><span style="color:#070;font-weight:bold">&lt;/td&gt;</span>
  <span style="color:#070;font-weight:bold">&lt;td</span> <span style="color:#b48">class</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">code</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span><span style="color:#070;font-weight:bold">&lt;pre&gt;</span>puts <span style="color:#070;font-weight:bold">&lt;span</span> <span style="color:#b48">style</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#606">background-color</span>:<span style="color:#0A0">hsla(0,100%,50%,0.05)</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span><span style="color:#070;font-weight:bold">&lt;span</span> <span style="color:#b48">style</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#606">color</span>:<span style="color:#0A0">#710</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>'<span style="color:#070;font-weight:bold">&lt;/span&gt;</span><span style="color:#070;font-weight:bold">&lt;span</span> <span style="color:#b48">style</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#606">color</span>:<span style="color:#0A0">#D20</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>hello, world<span style="color:#070;font-weight:bold">&lt;/span&gt;</span><span style="color:#070;font-weight:bold">&lt;span</span> <span style="color:#b48">style</span>=<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#606">color</span>:<span style="color:#0A0">#710</span><span style="color:#710">&quot;</span></span><span style="color:#070;font-weight:bold">&gt;</span>'<span style="color:#070;font-weight:bold">&lt;/span&gt;</span><span style="color:#070;font-weight:bold">&lt;/span&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/pre&gt;</span><span style="color:#070;font-weight:bold">&lt;/td&gt;</span>
<span style="color:#070;font-weight:bold">&lt;/tr&gt;</span><span style="color:#070;font-weight:bold">&lt;/table&gt;</span>
</pre></td>
</tr></table>

<p>参考</p>

<ul>
<li><p>nanoc導入メモ 4/5 「Markdown独自拡張」編</p>

<p><a href="http://n.blueblack.net/articles/2012-05-05_02_nanoc_markdown_customize/">http://n.blueblack.net/articles/2012-05-05_02_nanoc_markdown_customize/</a></p></li>
<li><p>Redcarpet のシンタックスハイライトに CodeRay を使う</p>

<p><a href="http://superbrothers.hatenablog.com/entry/20120129/1327840871">http://superbrothers.hatenablog.com/entry/20120129/1327840871</a></p></li>
</ul>


<div id='disqus_thread'></div>
<script>
  var disqus_shortname = 'chiranoura';
  var disqus_title = 'RedcarpetのレンダラにCodeRayによるシンタックスハイライトを追加';
  var disqus_identifier = '/articles/2014-01-23_01_using_coderay_with_redcarpet/';
  var disqus_category_id = '2807705';
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>
Please enable JavaScript to view the
<a href='http://disqus.com/?ref_noscript'>comments</a>
powered by Disqus.
</noscript>
<a class='dsq-brlink' href='http://disqus.com'>
comments powered by
<span class='logo-disqus'>Disqus</span>
</a>
</div>
</div>
<div id='side'>
<div id='ad'>
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- 最初 -->
<ins class="adsbygoogle" style="display:inline-block;width:234px;height:60px" data-ad-client="ca-pub-8247743603913410" data-ad-slot="6061651880"></ins>
<script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
</div>
<div id='top_category'>
<h2 class='Science'><a href="/category/science" rel="tag">Science</a></h2>
<div id='tags'>
<h3>Tags</h3>
<ul class='tags'>
<li><a href="/category/science/tag/coderay" rel="tag">CodeRay</a> x 1</li>
<li><a href="/category/science/tag/computer" rel="tag">Computer</a> x 2</li>
<li><a href="/category/science/tag/description" rel="tag">Description</a> x 1</li>
<li><a href="/category/science/tag/redcarpet" rel="tag">Redcarpet</a> x 1</li>
<li><a href="/category/science/tag/ruby" rel="tag">Ruby</a> x 2</li>
<li><a href="/category/science/tag/nanoc" rel="tag">nanoc</a> x 2</li>
</ul>
</div>
<div id='recent_posts'>
<h3>Recent Posts</h3>
<ul class='recent_posts'>
<li><a href="/articles/2014-01-23_01_using_coderay_with_redcarpet/">RedcarpetのレンダラにCodeRayによるシンタックスハイライトを追加</a></li>
<li><a href="/articles/2014-01-09_03_desc_of_sci/">Description of Science</a></li>
<li><a href="/articles/2012-10-22_01_nanoc_ijiri/">nanocいじり 始めました。</a></li>
</ul>
</div>
</div>
<div id='categories'>
<h1>Categories</h1>
<h2><a href="/">All</a></h2>
<h2 class='Art'><a href="/category/art" rel="tag">Art</a></h2>
<h2 class='Game'><a href="/category/game" rel="tag">Game</a></h2>
<h2 class='Language'><a href="/category/language" rel="tag">Language</a></h2>
<h2 class='Science'><a href="/category/science" rel="tag">Science</a></h2>
<h2 class='SocialActivities'><a href="/category/socialactivities" rel="tag">SocialActivities</a></h2>
</div>

</div>
<div id='footer'>
<p>copyright</p>
</div>
</div>
</body>
</html>
