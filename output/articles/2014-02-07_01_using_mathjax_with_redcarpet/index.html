<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml'>
<head>
<meta charset='utf-8'>
<meta content='nanoc 3.1.7' name='generator'>
<title>
ちらのうら - MathJaxで数式描画
</title>
<link href='/stylesheets/screen.css' media='screen' rel='stylesheet' type='text/css'>
<script type='text/x-mathjax-config'>
MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
</script>
<script src='https://c328740.ssl.cf1.rackcdn.com/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML' type='text/javascript'></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  
  ga('create', 'UA-44690113-1', 'nobody.jp');
  ga('require', 'linkid', 'linkid.js');
  ga('require', 'displayfeatures');
  ga('send', 'pageview');
</script>
</head>
<body>
<div id='container'>
<div id='header'>
<h1>
<a href='/'>
ちらのうら - chiranoura.nobody.jp
</a>
</h1>
</div>
<div id='main'>
<div class='article Science'>
<h2><a href="/articles/2014-02-07_01_using_mathjax_with_redcarpet/">MathJaxで数式描画</a></h2>
<h3>Created in: 2014-02-07  Author: iray_tno Category: <a href="/category/science" rel="tag">Science</a> Tags: <a href="/category/science/tag/computer" rel="tag">Computer</a><a href="/tag/computer" rel="tag">_a</a>, <a href="/category/science/tag/ruby" rel="tag">Ruby</a><a href="/tag/ruby" rel="tag">_a</a>, <a href="/category/science/tag/nanoc" rel="tag">Nanoc</a><a href="/tag/nanoc" rel="tag">_a</a>, <a href="/category/science/tag/mathjax" rel="tag">MathJax</a><a href="/tag/mathjax" rel="tag">_a</a>, <a href="/category/science/tag/redcarpet" rel="tag">Redcarpet</a><a href="/tag/redcarpet" rel="tag">_a</a></h3>
<div class='inner'>
<h4>はじめに</h4>

<p>MathJaxを使ってtex形式で書いた数式を表示できるようにしました。</p>

<p>通常はhtmlに数行追加するだけで使えるようになります。</p>

<p>ただ、markdownでも数式を書けるようにするためには、レンダラの定義が必要だったのでメモしておきます。</p>

<ul>
<li>nanoc(<a href="http://nanoc.ws" target="_blank">http://nanoc.ws</a>)</li>
<li>Redcarpet(<a href="https://github.com/vmg/redcarpet" target="_blank">https://github.com/vmg/redcarpet</a>)</li>
<li>MathJax(<a href="http://www.mathjax.org" target="_blank">http://www.mathjax.org</a>)</li>
</ul>

<!-- headline -->

<h4>インストール</h4>

<p>まずはテンプレートにMathJaxの設定を追加します。現在IE8対策は必要ないようです。</p>

<blockquote>
<p>In MathJax v2.0, IE8 and IE9 run faster in their IE8 and IE9 standards mode than in IE7 emulation mode.
(<a href="http://www.mathjax.org/resources/browser-compatibility/" target="_blank">http://www.mathjax.org/resources/browser-compatibility/</a>)</p>
</blockquote>

<p>このブログではテンプレートにhamlを用いているので、default.hamlを以下のようにしました。</p>
<table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
</pre></td>
  <td class="code"><pre><span style="color:#34b">!!! XML</span>
<span style="color:#34b">!!! 5</span>
<span style="color:#777">&lt;!-- default.haml --&gt;</span>
<span style="color:#070;font-weight:bold">%html</span>{<span style="color:#A60">:xmlns</span> =&gt;<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">http://www.w3.org/1999/xhtml</span><span style="color:#710">&quot;</span></span>}
  <span style="color:#070;font-weight:bold">%head</span>
    <span style="color:#070;font-weight:bold">%script</span>{<span style="color:#A60">:type</span> =&gt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">text/x-mathjax-config</span><span style="color:#710">&quot;</span></span>}
      MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
    <span style="color:#070;font-weight:bold">%script</span>{<span style="color:#A60">:type</span> =&gt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">text/javascript</span><span style="color:#710">&quot;</span></span>, <span style="color:#A60">:src</span> =&gt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">https://c328740.ssl.cf1.ra</span><span style="color:#710">&quot;</span></span>+ |
      &quot;ckcdn.com/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML&quot;}     |

  <span style="color:#070;font-weight:bold">%body</span>
</pre></td>
</tr></table>

<p>markdown内でも書けるように、default.rbファイルで以下のようにレンダラを定義しました。codespanではinlineでの数式描画を設定しています。</p>
<table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td>
  <td class="code"><pre><span style="color:#777">#default.rb</span>
require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">redcarpet</span><span style="color:#710">&quot;</span></span>
require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">cgi</span><span style="color:#710">&quot;</span></span>
require <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">coderay</span><span style="color:#710">&quot;</span></span>

<span style="color:#080;font-weight:bold">class</span> <span style="color:#B06;font-weight:bold">ArticleRenderer</span> &lt; <span style="color:#036;font-weight:bold">Redcarpet</span>::<span style="color:#036;font-weight:bold">Render</span>::<span style="color:#036;font-weight:bold">XHTML</span>
  <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">block_code</span>(code, language)
    <span style="color:#080;font-weight:bold">if</span> language==<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">mathjax</span><span style="color:#710">&quot;</span></span>
      <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">&lt;script type=</span><span style="color:#b0b">\&quot;</span><span style="color:#D20">math/tex; mode=display</span><span style="color:#b0b">\&quot;</span><span style="color:#D20">&gt;</span><span style="color:#b0b">\n</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>code<span style="font-weight:bold;color:#666">}</span></span><span style="color:#b0b">\n</span><span style="color:#D20">&lt;/script&gt;</span><span style="color:#710">&quot;</span></span>
    <span style="color:#080;font-weight:bold">elsif</span> language
      <span style="color:#036;font-weight:bold">CodeRay</span>.scan(code, language).div(<span style="color:#A60">:line_numbers</span> =&gt; <span style="color:#A60">:table</span>, 
                                       <span style="color:#A60">:line_number_anchors</span> =&gt; <span style="color:#069">false</span>,
                                       <span style="color:#A60">:bold_every</span> =&gt; <span style="color:#069">false</span>)
    <span style="color:#080;font-weight:bold">else</span>
      <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#b0b">\n</span><span style="color:#D20">&lt;pre&gt;&lt;code&gt;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>code<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">&lt;/code&gt;&lt;/pre&gt;</span><span style="color:#b0b">\n</span><span style="color:#710">&quot;</span></span>
    <span style="color:#080;font-weight:bold">end</span>
  <span style="color:#080;font-weight:bold">end</span>

  <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">codespan</span>(code)
    <span style="color:#080;font-weight:bold">if</span> code[<span style="color:#00D">0</span>] == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">$</span><span style="color:#710">&quot;</span></span> &amp;&amp; code[<span style="color:#00D">-1</span>] == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">$</span><span style="color:#710">&quot;</span></span>
      <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">&lt;script type=</span><span style="color:#b0b">\&quot;</span><span style="color:#D20">math/tex</span><span style="color:#b0b">\&quot;</span><span style="color:#D20">&gt;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>code[<span style="color:#00D">1</span>...<span style="color:#00D">-1</span>]<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">&lt;/script&gt;</span><span style="color:#710">&quot;</span></span>
    <span style="color:#080;font-weight:bold">elsif</span> code[<span style="color:#00D">0</span>..<span style="color:#00D">1</span>] == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#b0b">\\</span><span style="color:#D20">(</span><span style="color:#710">&quot;</span></span> &amp;&amp; code[<span style="color:#00D">-2</span>..<span style="color:#00D">-1</span>] == <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#b0b">\\</span><span style="color:#D20">)</span><span style="color:#710">&quot;</span></span>
      <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">&lt;script type=</span><span style="color:#b0b">\&quot;</span><span style="color:#D20">math/tex</span><span style="color:#b0b">\&quot;</span><span style="color:#D20">&gt;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>code[<span style="color:#00D">2</span>...<span style="color:#00D">-2</span>]<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">&lt;/script&gt;</span><span style="color:#710">&quot;</span></span>
    <span style="color:#080;font-weight:bold">else</span>
      <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#D20">&lt;code&gt;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>code<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">&lt;/code&gt;</span><span style="color:#710">&quot;</span></span>
    <span style="color:#080;font-weight:bold">end</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></td>
</tr></table>

<p>Rulesでfilter適用時にrendererオプションを定義します。</p>
<table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td>
  <td class="code"><pre><span style="color:#777">#Rules</span>
<span style="color:#777">#compile ----------------------------------------------------------------------</span>
compile <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">*</span><span style="color:#710">'</span></span> <span style="color:#080;font-weight:bold">do</span>
  <span style="color:#080;font-weight:bold">if</span> item.binary?
    <span style="color:#777"># don't filter binary items</span>
  <span style="color:#080;font-weight:bold">else</span>
    <span style="color:#080;font-weight:bold">case</span> item[<span style="color:#A60">:extension</span>]
      <span style="color:#080;font-weight:bold">when</span> <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">md</span><span style="color:#710">'</span></span>
        filter <span style="color:#A60">:redcarpet</span>, <span style="color:#A60">:options</span>  =&gt; { <span style="color:#A60">:fenced_code_blocks</span> =&gt; <span style="color:#069">true</span>,
                                          <span style="color:#A60">:autolink</span> -&gt; <span style="color:#069">true</span> },
                           <span style="color:#A60">:renderer</span> =&gt; <span style="color:#036;font-weight:bold">ArticleRenderer</span>
        layout <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">default</span><span style="color:#710">'</span></span>
      <span style="color:#080;font-weight:bold">else</span>
        filter <span style="color:#A60">:haml</span>
        layout <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">default</span><span style="color:#710">'</span></span>
    <span style="color:#080;font-weight:bold">end</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></td>
</tr></table>

<p>これで使えるようになりました。</p>

<h4>テスト</h4>

<h5>例①</h5>

<h6>markdown内での記述</h6>
<table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
</pre></td>
  <td class="code"><pre>ニュートンの運動方程式は、`$F = ma$`です。
ピタゴラスの定理は、`\(a^2 = b^2 + c^2\)`です。
</pre></td>
</tr></table>

<h6>出力</h6>

<p>ニュートンの運動方程式は、<script type="math/tex">F = ma</script>です。ピタゴラスの定理は、<script type="math/tex">a^2 = b^2 + c^2</script>です。</p>

<h5>例②</h5>

<h6>markdown内での記述</h6>
<table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
</pre></td>
  <td class="code"><pre>ミカエリスメンテンの式

　```mathjax
　v = \rm\frac{V_{max}[S]}{K_m + [S]}
　```
</pre></td>
</tr></table>

<h6>出力</h6>

<p>ミカエリスメンテンの式</p>
<script type="math/tex; mode=display">
v = \rm\frac{V_{max}[S]}{K_m + [S]}

</script>
<h4>参考</h4>

<ul>
<li><p>MathJaxの使い方
<a href="http://genkuroki.web.fc2.com/" target="_blank">http://genkuroki.web.fc2.com/</a></p></li>
<li><p>ruhoh plugin to overload the redcarpet parser with mathjax tags
<a href="https://gist.github.com/plusjade/2699636" target="_blank">https://gist.github.com/plusjade/2699636</a></p></li>
</ul>


<div id='disqus_thread'></div>
<script>
  var disqus_shortname = 'chiranoura';
  var disqus_title = 'MathJaxで数式描画';
  var disqus_identifier = '/articles/2014-02-07_01_using_mathjax_with_redcarpet/';
  var disqus_category_id = '2807705';
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>
Please enable JavaScript to view the
<a href='http://disqus.com/?ref_noscript'>comments</a>
powered by Disqus.
</noscript>
<a class='dsq-brlink' href='http://disqus.com'>
comments powered by
<span class='logo-disqus'>Disqus</span>
</a>
</div>
</div>
</div>
<div id='side'>
<div id='side_upper_ads'>
<script async src='//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js'></script>
<ins class='adsbygoogle' data-ad-client='ca-pub-8247743603913410' data-ad-slot='6061651880' style='display:inline-block;width:234px;height:60px'></ins>
<script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
</div>
<div id='top_category'>
<h2 class='Science'><a href="/category/science" rel="tag">Science</a></h2>
<div id='tags'>
<h3>Tags</h3>
<ul class='tags'>
<li><a href="/category/science/tag/coderay" rel="tag">CodeRay</a> x 1</li>
<li><a href="/category/science/tag/computer" rel="tag">Computer</a> x 6</li>
<li><a href="/category/science/tag/cygwin" rel="tag">Cygwin</a> x 3</li>
<li><a href="/category/science/tag/description" rel="tag">Description</a> x 1</li>
<li><a href="/category/science/tag/mathjax" rel="tag">MathJax</a> x 1</li>
<li><a href="/category/science/tag/matplotlib" rel="tag">Matplotlib</a> x 1</li>
<li><a href="/category/science/tag/nanoc" rel="tag">Nanoc</a> x 3</li>
<li><a href="/category/science/tag/python" rel="tag">Python</a> x 3</li>
<li><a href="/category/science/tag/redcarpet" rel="tag">Redcarpet</a> x 3</li>
<li><a href="/category/science/tag/ruby" rel="tag">Ruby</a> x 3</li>
<li><a href="/category/science/tag/pip" rel="tag">pip</a> x 2</li>
<li><a href="/category/science/tag/setuptools" rel="tag">setuptools</a> x 2</li>
</ul>
</div>
<div id='recent_posts'>
<h3>Recent Posts</h3>
<ul class='recent_posts'>
<li><a href="/articles/2014-05-27_01_how_to_install_pip_and_setuptools/">Cygwin上でpipとsetuptoolsをインストールする方法</a></li>
<li><a href="/articles/2014-03-20_01_how_to_install_matplotlib_on_cygwin/">Cygwin上でMatplotlibをインストールする。</a></li>
<li><a href="/articles/2014-03-04_01_how_to_install_pip_and_setuptools/">Cygwin上でpipとsetuptoolsをインストールする方法</a></li>
<li><a href="/articles/2014-02-07_01_using_mathjax_with_redcarpet/">MathJaxで数式描画</a></li>
<li><a href="/articles/2014-01-23_01_using_coderay_with_redcarpet/">RedcarpetのレンダラにCodeRayによるシンタックスハイライトを追加</a></li>
</ul>
</div>
</div>
<div id='categories'>
<h1>Categories</h1>
<h2><a href="/">All</a></h2>
<h2 class='Art'><a href="/category/art" rel="tag">Art</a></h2>
<h2 class='Game'><a href="/category/game" rel="tag">Game</a></h2>
<h2 class='Language'><a href="/category/language" rel="tag">Language</a></h2>
<h2 class='Science'><a href="/category/science" rel="tag">Science</a></h2>
<h2 class='SocialActivities'><a href="/category/socialactivities" rel="tag">SocialActivities</a></h2>
</div>
<div id='side_lower_ads'>
<script async src='//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js'></script>
<ins class='adsbygoogle' data-ad-client='ca-pub-8247743603913410' data-ad-slot='2280803480' style='display:inline-block;width:160px;height:600px'></ins>
<script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
</div>

</div>
<div id='footer'>
<p>copyright</p>
</div>
</div>
</body>
</html>
