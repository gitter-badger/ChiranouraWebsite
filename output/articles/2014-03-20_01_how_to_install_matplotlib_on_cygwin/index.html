<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml'>
<head>
<meta charset='utf-8'>
<meta content='nanoc 3.1.7' name='generator'>
<title>
ちらのうら - Cygwin上でMatplotlibをインストールする。
</title>
<link href='/stylesheets/screen.css' media='screen' rel='stylesheet' type='text/css'>
<script type='text/x-mathjax-config'>
MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});
</script>
<script src='https://c328740.ssl.cf1.rackcdn.com/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML' type='text/javascript'></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  
  ga('create', 'UA-44690113-1', 'nobody.jp');
  ga('require', 'linkid', 'linkid.js');
  ga('require', 'displayfeatures');
  ga('send', 'pageview');
</script>
</head>
<body>
<div id='container'>
<div id='header'>
<h1>
<a href='/'>
ちらのうら - chiranoura.nobody.jp
</a>
</h1>
</div>
<div id='main'>
<div class='article Science'>
<h2><a href="/articles/2014-03-20_01_how_to_install_matplotlib_on_cygwin/">Cygwin上でMatplotlibをインストールする。</a></h2>
<h3>Created in: 2014-03-20  Author: iray_tno Category: <a href="/category/science" rel="tag">Science</a> Tags: <a href="/category/science/tag/computer" rel="tag">Computer</a><a href="/tag/computer" rel="tag">_a</a>, <a href="/category/science/tag/python" rel="tag">Python</a><a href="/tag/python" rel="tag">_a</a>, <a href="/category/science/tag/cygwin" rel="tag">Cygwin</a><a href="/tag/cygwin" rel="tag">_a</a>, <a href="/category/science/tag/matplotlib" rel="tag">Matplotlib</a><a href="/tag/matplotlib" rel="tag">_a</a>, <a href="/category/science/tag/redcarpet" rel="tag">Redcarpet</a><a href="/tag/redcarpet" rel="tag">_a</a></h3>
<div class='inner'>
<h4>はじめに</h4>

<p>前回pipをインストールしたのはMatplotlibを使うためでした。
しかし、<code>pip install matplotlib</code>とするとビルド時にエラーを吐いて止まりました。</p>

<p>調べてみると、これはCygwin固有のバグのようで、既に報告されており次のバージョンでは直ると思います。</p>

<p>修正方法もわかっていたので、練習も兼ねてpatchを作成し動くようにしました。</p>

<p>以下に手順をまとめます。windows8+cyginw64とwindows7+cygwin64で動くのを確認済です。</p>

<!-- headline -->

<h4>依存の解決</h4>

<p>cygwinのsetup-x86_64.exeから以下のパッケージをインストールします。</p>

<ul>
<li>python-numpy</li>
<li>X11カテゴリーすべて</li>
<li>libfreetype-devel</li>
<li>python-gtk2.0</li>
<li>python-tkinter</li>
<li>libpng-devel</li>
<li>libX11-devel</li>
</ul>

<p>また、以下のurlからmatplotlib-1.3.1.tar.gzをダウンロードし、適当なディレクトリに展開します。</p>

<p>matplotlib(<a href="http://matplotlib.org/downloads.html" target="_blank">http://matplotlib.org/downloads.html</a>)</p>

<h4>バグの修正とインストール</h4>

<p>単に<code>python setup.py install</code>とすると、ビルドに失敗します。</p>

<p>matplotlib error while installing pyspeckit
(<a href="http://stackoverflow.com/questions/18560249/matplotlib-error-while-installing-pyspeckit" target="_blank">http://stackoverflow.com/questions/18560249/matplotlib-error-while-installing-pyspeckit</a>)</p>

<p>修正方法は<code>_C</code>という名前の変数を出現箇所すべて<code>_Co</code>(なんでもいい)に変更するだけですが、練習としてpatchを作成しました。</p>
<table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td>
  <td class="code"><pre><span style="color:#f8f;background:#505" class="line"><span style="color:#f4f">--- </span><span style="color:white">./lib/matplotlib/tri/_tri.cpp   2013-10-10 21:42:48.000000000 +0900</span></span>
<span style="color:#f8f;background:#505" class="line"><span style="color:#f4f">+++ </span><span style="color:white">./lib/matplotlib/tri/_tri.cpp   2014-01-10 13:29:25.837581500 +0900</span></span>
<span style="color:#bbf;background:#007" class="line"><span style="color:#88f">@@</span> -2177,13 +2177,13 <span style="color:#88f">@@</span></span>


 RandomNumberGenerator::RandomNumberGenerator(unsigned long seed)
<span style="background:hsla(0,100%,50%,0.12)" class="line"><span style="color:#c00;background:transparent;font-weight:bold">-</span>    : _M(21870), _A(1291), _C(4621), _seed(seed % _M)</span>
<span style="background:hsla(120,100%,50%,0.12)" class="line"><span style="color:#0c0;background:transparent;font-weight:bold">+</span>    : _M(21870), _A(1291), _C<span style="background-color:hsla(120,100%,50%,0.2);border:1pxsolidhsla(120,100%,25%,0.5);margin:-1px;border-top:none;border-bottom-left-radius:5px;border-bottom-right-radius:5px">o</span>(4621), _seed(seed % _M)</span>
 {}

 unsigned long
 RandomNumberGenerator::operator()(unsigned long max_value)
 {
<span style="background:hsla(0,100%,50%,0.12)" class="line"><span style="color:#c00;background:transparent;font-weight:bold">-</span>    _seed = (_seed*_A + _C) % _M;</span>
<span style="background:hsla(120,100%,50%,0.12)" class="line"><span style="color:#0c0;background:transparent;font-weight:bold">+</span>    _seed = (_seed*_A + _C<span style="background-color:hsla(120,100%,50%,0.2);border:1pxsolidhsla(120,100%,25%,0.5);margin:-1px;border-top:none;border-bottom-left-radius:5px;border-bottom-right-radius:5px">o</span>) % _M;</span>
     return (_seed*max_value) / _M;
 }

<span style="color:#f8f;background:#505" class="line"><span style="color:#f4f">--- </span><span style="color:white">./lib/matplotlib/tri/_tri.h 2013-10-10 21:42:48.000000000 +0900</span></span>
<span style="color:#f8f;background:#505" class="line"><span style="color:#f4f">+++ </span><span style="color:white">./lib/matplotlib/tri/_tri.h 2014-01-10 13:25:46.188018200 +0900</span></span>
<span style="color:#bbf;background:#007" class="line"><span style="color:#88f">@@</span> -818,7 +818,7 <span style="color:#88f">@@</span></span>
     unsigned long operator()(unsigned long max_value);

 private:
<span style="background:hsla(0,100%,50%,0.12)" class="line"><span style="color:#c00;background:transparent;font-weight:bold">-</span>    const unsigned long _M, _A, _C;</span>
<span style="background:hsla(120,100%,50%,0.12)" class="line"><span style="color:#0c0;background:transparent;font-weight:bold">+</span>    const unsigned long _M, _A, _C<span style="background-color:hsla(120,100%,50%,0.2);border:1pxsolidhsla(120,100%,25%,0.5);margin:-1px;border-top:none;border-bottom-left-radius:5px;border-bottom-right-radius:5px">o</span>;</span>
     unsigned long _seed;
 };
</pre></td>
</tr></table>

<p>上記パッチをコピペするか、下記urlからダウンロードして解凍し、matplotlib-1.3.1フォルダ直下に置きます。</p>

<p>gist(<a href="https://gist.github.com/iray-tno/3e3121cc26eb38e06530" target="_blank">https://gist.github.com/iray-tno/3e3121cc26eb38e06530</a>)</p>

<p>cygwinでmatplotlib-1.3.1フォルダ直下に移動し、以下のコマンドを実行します。</p>
<table class="CodeRay"><tr>
  <td class="line-numbers"><pre>1
2
</pre></td>
  <td class="code"><pre>patch -p0 -d ./ &lt; ./matplotlib-1.3.1_cygwin.patch
python setup.py install
</pre></td>
</tr></table>

<p>これでビルドが成功したと思います。</p>

<h4>サンプル</h4>

<p>公式のサンプルを実行してみます。</p>

<p><a href="http://matplotlib.org/examples/mplot3d/lines3d_demo.html" target="_blank">http://matplotlib.org/examples/mplot3d/lines3d_demo.html</a></p>

<p><code>startxwin</code>とするとX Serverが起動し、ターミナルがひらきます。</p>

<p>そのターミナルの中で、<code>python ./line3d_demo.py</code>とすると、新たにウィンドウが開き、プロットが表示されます。</p>

<p><img src="/img/articles/2014-03-20_01_lines3d_demo.jpg" alt="2014-03-20_01_lines3d_demo" title="2014-03-20_01_lines3d_demo"/></p>

<h4>Cygwin標準の端末（mintty）でXを使う</h4>

<p>Cygwin標準の端末（mintty）でXを使う方法は以下のurlを参考にしてください。</p>

<p>CygwinでX Windowを使う(<a href="http://keisanbutsuriya.blog.fc2.com/blog-entry-40.html" target="_blank">http://keisanbutsuriya.blog.fc2.com/blog-entry-40.html</a>)</p>

<p>簡単にまとめると</p>

<ul>
<li>.bashrcの最後に<code>export DISPLAY=:0.0</code>を追加</li>
<li>.bashrcと同じ場所に空のファイル<code>.startxwinrc</code>を作成</li>
</ul>


<div id='disqus_thread'></div>
<script>
  var disqus_shortname = 'chiranoura';
  var disqus_title = 'Cygwin上でMatplotlibをインストールする。';
  var disqus_identifier = '/articles/2014-03-20_01_how_to_install_matplotlib_on_cygwin/';
  var disqus_category_id = '2807705';
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>
Please enable JavaScript to view the
<a href='http://disqus.com/?ref_noscript'>comments</a>
powered by Disqus.
</noscript>
<a class='dsq-brlink' href='http://disqus.com'>
comments powered by
<span class='logo-disqus'>Disqus</span>
</a>
</div>
</div>
</div>
<div id='side'>
<div id='side_upper_ads'>
<script async src='//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js'></script>
<ins class='adsbygoogle' data-ad-client='ca-pub-8247743603913410' data-ad-slot='6061651880' style='display:inline-block;width:234px;height:60px'></ins>
<script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
</div>
<div id='top_category'>
<h2 class='Science'><a href="/category/science" rel="tag">Science</a></h2>
<div id='tags'>
<h3>Tags</h3>
<ul class='tags'>
<li><a href="/category/science/tag/coderay" rel="tag">CodeRay</a> x 1</li>
<li><a href="/category/science/tag/computer" rel="tag">Computer</a> x 5</li>
<li><a href="/category/science/tag/cygwin" rel="tag">Cygwin</a> x 2</li>
<li><a href="/category/science/tag/description" rel="tag">Description</a> x 1</li>
<li><a href="/category/science/tag/mathjax" rel="tag">MathJax</a> x 1</li>
<li><a href="/category/science/tag/matplotlib" rel="tag">Matplotlib</a> x 1</li>
<li><a href="/category/science/tag/nanoc" rel="tag">Nanoc</a> x 3</li>
<li><a href="/category/science/tag/python" rel="tag">Python</a> x 2</li>
<li><a href="/category/science/tag/redcarpet" rel="tag">Redcarpet</a> x 3</li>
<li><a href="/category/science/tag/ruby" rel="tag">Ruby</a> x 3</li>
<li><a href="/category/science/tag/pip" rel="tag">pip</a> x 1</li>
<li><a href="/category/science/tag/setuptools" rel="tag">setuptools</a> x 1</li>
</ul>
</div>
<div id='recent_posts'>
<h3>Recent Posts</h3>
<ul class='recent_posts'>
<li><a href="/articles/2014-03-20_01_how_to_install_matplotlib_on_cygwin/">Cygwin上でMatplotlibをインストールする。</a></li>
<li><a href="/articles/2014-03-04_01_how_to_install_pip_and_setuptools/">Cygwin上でpipとsetuptoolsをインストールする方法</a></li>
<li><a href="/articles/2014-02-07_01_using_mathjax_with_redcarpet/">MathJaxで数式描画</a></li>
<li><a href="/articles/2014-01-23_01_using_coderay_with_redcarpet/">RedcarpetのレンダラにCodeRayによるシンタックスハイライトを追加</a></li>
<li><a href="/articles/2014-01-09_03_desc_of_sci/">Description of Science</a></li>
</ul>
</div>
</div>
<div id='categories'>
<h1>Categories</h1>
<h2><a href="/">All</a></h2>
<h2 class='Art'><a href="/category/art" rel="tag">Art</a></h2>
<h2 class='Game'><a href="/category/game" rel="tag">Game</a></h2>
<h2 class='Language'><a href="/category/language" rel="tag">Language</a></h2>
<h2 class='Science'><a href="/category/science" rel="tag">Science</a></h2>
<h2 class='SocialActivities'><a href="/category/socialactivities" rel="tag">SocialActivities</a></h2>
</div>
<div id='side_lower_ads'>
<script async src='//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js'></script>
<ins class='adsbygoogle' data-ad-client='ca-pub-8247743603913410' data-ad-slot='2280803480' style='display:inline-block;width:160px;height:600px'></ins>
<script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
</div>

</div>
<div id='footer'>
<p>copyright</p>
</div>
</div>
</body>
</html>
